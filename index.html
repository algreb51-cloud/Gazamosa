<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MosaData Cloud Pro v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; scroll-behavior: smooth; }
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .btn-gradient { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-gradient:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4); }
        .input-focus { transition: all 0.2s; border: 2px solid transparent; }
        .input-focus:focus { border-color: #2563eb; background: white; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .no-spinner::-webkit-inner-spin-button, .no-spinner::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .undo-toast { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translate(-50%, 100%); } to { transform: translate(-50%, 0); } }
    </style>
</head>
<body class="text-slate-800">

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed top-6 left-1/2 -translate-x-1/2 z-[9999] flex flex-col gap-2"></div>
    
    <!-- Undo Delete Toast -->
    <div id="undo-toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-[9999] hidden undo-toast">
        <div class="bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-6 border border-white/10">
            <span class="text-sm font-bold">تم حذف السجل بنجاح</span>
            <button id="undo-btn" class="text-blue-400 font-black text-sm hover:underline italic underline-offset-4">تراجع الآن (5ث)</button>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="auth-screen" class="fixed inset-0 z-[5000] bg-white flex items-center justify-center p-6">
        <div class="max-w-md w-full text-center fade-in">
            <div class="mb-8 inline-block p-6 bg-blue-600 rounded-[2.5rem] shadow-2xl shadow-blue-200">
                <i data-lucide="cloud-lightning" class="text-white w-14 h-14"></i>
            </div>
            <h1 class="text-5xl font-black mb-2 tracking-tighter">Mosa<span class="text-blue-600">Data</span></h1>
            <p class="text-slate-400 font-bold mb-10">نظام الإدارة السحابي المتكامل</p>
            <div class="space-y-4" id="login-form-area">
                <button onclick="showAdminPass()" id="admin-gate-btn" class="w-full py-5 bg-slate-900 text-white rounded-3xl font-black flex items-center justify-center gap-3 transition-all hover:bg-black">
                    <i data-lucide="shield-check" class="w-6 h-6"></i> بوابة المدير
                </button>
                <div id="admin-pass-input" class="hidden space-y-3">
                    <input type="password" id="login-pass" placeholder="كلمة المرور (123)" class="w-full p-5 bg-slate-50 border-2 border-slate-100 rounded-3xl text-center font-black outline-none focus:border-blue-600 transition-all">
                    <button onclick="handleLogin('admin')" class="w-full py-5 btn-gradient text-white rounded-3xl font-black shadow-lg">دخول المدير</button>
                </div>
                <button onclick="handleLogin('guest')" class="w-full py-5 bg-slate-100 text-slate-500 rounded-3xl font-bold hover:bg-slate-200 transition">دخول زائر (مشاهدة محدودة)</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="app-container" class="hidden min-h-screen pb-20">
        <!-- Header -->
        <header class="sticky top-0 z-[1000] bg-white/80 backdrop-blur-xl border-b border-slate-100 px-6 py-4">
            <div class="max-w-[1600px] mx-auto flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="bg-blue-600 p-3 rounded-2xl text-white shadow-lg shadow-blue-200">
                        <i data-lucide="database" class="w-7 h-7"></i>
                    </div>
                    <div>
                        <h2 class="font-black text-2xl">MosaData <span id="role-tag" class="text-[10px] bg-blue-100 text-blue-600 px-3 py-1 rounded-full mr-2">Admin</span></h2>
                        <p class="text-[10px] text-slate-400 font-bold tracking-widest uppercase">Cloud Database Infrastructure</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="location.reload()" class="p-4 text-rose-500 hover:bg-rose-50 rounded-2xl transition"><i data-lucide="log-out"></i></button>
                </div>
            </div>
        </header>

        <main class="max-w-[1600px] mx-auto p-6 space-y-8">
            <!-- Stats Bar -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="glass-panel p-6 rounded-[2.5rem] shadow-sm border border-white">
                    <div class="flex items-center gap-4">
                        <div class="p-4 bg-blue-50 text-blue-600 rounded-2xl"><i data-lucide="users"></i></div>
                        <div>
                            <p class="text-xs font-bold text-slate-400">إجمالي العائلات</p>
                            <h3 id="stat-families" class="text-3xl font-black">0</h3>
                        </div>
                    </div>
                </div>
                <div class="glass-panel p-6 rounded-[2.5rem] shadow-sm border border-white">
                    <div class="flex items-center gap-4">
                        <div class="p-4 bg-emerald-50 text-emerald-600 rounded-2xl"><i data-lucide="user-check"></i></div>
                        <div>
                            <p class="text-xs font-bold text-slate-400">إجمالي الأفراد</p>
                            <h3 id="stat-individuals" class="text-3xl font-black">0</h3>
                        </div>
                    </div>
                </div>
                <div class="glass-panel p-6 rounded-[2.5rem] shadow-sm border border-white">
                    <div class="flex items-center gap-4">
                        <div class="p-4 bg-rose-50 text-rose-600 rounded-2xl"><i data-lucide="alert-circle"></i></div>
                        <div>
                            <p class="text-xs font-bold text-slate-400">هويات مكررة</p>
                            <h3 id="stat-duplicates" class="text-3xl font-black text-rose-600">0</h3>
                        </div>
                    </div>
                </div>
                <div id="admin-shortcuts" class="hidden flex gap-2">
                    <button onclick="openForm()" class="flex-1 btn-gradient text-white rounded-[2rem] font-black text-sm shadow-xl flex items-center justify-center gap-2">
                        <i data-lucide="plus-circle"></i> إضافة سجل جديد
                    </button>
                </div>
            </div>

            <!-- Controls Panel -->
            <div class="glass-panel p-6 rounded-[3rem] shadow-lg border border-white space-y-6">
                <div class="flex flex-wrap gap-4 items-center">
                    <div class="relative flex-1 min-w-[300px]">
                        <i data-lucide="search" class="absolute right-5 top-1/2 -translate-y-1/2 text-slate-300 w-5 h-5"></i>
                        <input type="text" id="main-search" oninput="renderData()" placeholder="بحث سريع في كافة الحقول..." class="w-full pr-14 pl-6 py-5 bg-slate-50 border-none rounded-3xl outline-none focus:ring-4 focus:ring-blue-500/10 font-bold transition-all">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="toggleAdvancedFilter()" class="p-5 bg-white border border-slate-100 rounded-3xl text-slate-400 hover:text-blue-600 transition shadow-sm"><i data-lucide="sliders-horizontal"></i></button>
                        <div id="admin-export-tools" class="hidden flex gap-2">
                            <button onclick="downloadTemplate()" class="px-6 py-4 bg-white border border-slate-200 text-slate-600 rounded-3xl font-black text-xs hover:bg-slate-50 transition shadow-sm flex items-center gap-2">
                                <i data-lucide="download-cloud" class="w-4 h-4"></i> قالب البيانات
                            </button>
                            <button onclick="document.getElementById('excel-upload').click()" class="px-6 py-4 bg-emerald-50 text-emerald-600 rounded-3xl font-black text-xs hover:bg-emerald-100 transition shadow-sm flex items-center gap-2">
                                <i data-lucide="file-up" class="w-4 h-4"></i> استيراد Excel
                            </button>
                            <input type="file" id="excel-upload" class="hidden" accept=".xlsx, .xls" onchange="handleExcelImport(event)">
                            <button onclick="openExportModal()" class="px-6 py-4 bg-amber-50 text-amber-600 rounded-3xl font-black text-xs hover:bg-amber-100 transition shadow-sm flex items-center gap-2">
                                <i data-lucide="file-output" class="w-4 h-4"></i> تصدير مخصص
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Advanced Filters (Collapsible) -->
                <div id="advanced-filters" class="hidden grid grid-cols-1 md:grid-cols-4 gap-4 pt-4 border-t border-slate-100 fade-in">
                    <select id="filter-status" onchange="renderData()" class="p-4 bg-white border border-slate-100 rounded-2xl text-xs font-bold outline-none">
                        <option value="">كل الحالات الاجتماعية</option>
                        <option>متزوج</option><option>ارمله</option><option>مطلقة</option><option>مهجورة</option><option>اعزب</option><option>ايتام</option>
                    </select>
                    <input type="text" id="filter-delegate" oninput="renderData()" placeholder="تصفية حسب المندوب" class="p-4 bg-white border border-slate-100 rounded-2xl text-xs font-bold outline-none">
                    <input type="text" id="filter-area" oninput="renderData()" placeholder="المنطقة" class="p-4 bg-white border border-slate-100 rounded-2xl text-xs font-bold outline-none">
                    <button onclick="clearFilters()" class="text-rose-500 font-black text-xs hover:underline">مسح الكل</button>
                </div>
            </div>

            <!-- Main Table -->
            <div class="bg-white rounded-[3.5rem] shadow-2xl shadow-slate-200/50 border border-slate-100 overflow-hidden">
                <div class="overflow-x-auto custom-scroll">
                    <table class="w-full text-right">
                        <thead>
                            <tr class="bg-slate-50/50 text-[11px] font-black text-slate-400 uppercase tracking-widest border-b border-slate-100">
                                <th class="px-10 py-7">رب الأسرة / الهوية</th>
                                <th class="px-10 py-7">المندوب</th>
                                <th class="px-10 py-7">الحالة</th>
                                <th class="px-10 py-7">منطقة النزوح</th>
                                <th class="px-10 py-7">عدد الأفراد</th>
                                <th class="px-10 py-7 text-center">التحكم</th>
                            </tr>
                        </thead>
                        <tbody id="main-table-body" class="divide-y divide-slate-50 font-bold text-slate-600">
                            <!-- JS Inject -->
                        </tbody>
                    </table>
                </div>
                <div id="empty-state" class="hidden py-40 text-center flex flex-col items-center">
                    <div class="bg-slate-50 p-8 rounded-full mb-4 text-slate-200"><i data-lucide="database-zap" class="w-16 h-16"></i></div>
                    <p class="text-slate-400 font-black text-xl italic tracking-tight">قاعدة البيانات السحابية فارغة حالياً</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Form Modal (Full Add/Edit) -->
    <div id="form-modal" class="fixed inset-0 z-[6000] bg-slate-900/60 backdrop-blur-md hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-6xl max-h-[92vh] rounded-[4rem] shadow-2xl flex flex-col overflow-hidden fade-in">
            <div class="p-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                <div class="flex items-center gap-4">
                    <div id="modal-icon" class="p-3 bg-blue-600 text-white rounded-2xl"><i data-lucide="plus-circle"></i></div>
                    <h2 id="modal-title" class="text-3xl font-black text-slate-900">إضافة سجل سحابي جديد</h2>
                </div>
                <button onclick="closeModals()" class="p-4 hover:bg-rose-100 text-rose-500 rounded-2xl transition"><i data-lucide="x"></i></button>
            </div>
            
            <form id="main-form" class="flex-1 overflow-y-auto p-10 space-y-12 custom-scroll">
                <!-- Section 1: Basic Info -->
                <div class="space-y-6">
                    <div class="flex items-center gap-3 text-blue-600 font-black text-sm uppercase"><i data-lucide="user"></i> بيانات رب الأسرة والزوجة</div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">الاسم الكامل لرب الأسرة</label>
                            <input type="text" name="h_name" required class="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold input-focus">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">هوية رب الأسرة (9 أرقام)</label>
                            <input type="number" name="h_id" required maxlength="9" oninput="limitLen(this, 9)" class="no-spinner w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold input-focus">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">رقم الجوال (9 أرقام بدون 0)</label>
                            <input type="number" name="h_phone" required maxlength="9" oninput="limitLen(this, 9)" class="no-spinner w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold input-focus">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">اسم الزوجة</label>
                            <input type="text" name="wife_name" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none input-focus">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">هوية الزوجة</label>
                            <input type="number" name="wife_id" maxlength="9" oninput="limitLen(this, 9)" class="no-spinner w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none input-focus">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">الحالة الاجتماعية</label>
                            <select name="status" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none input-focus">
                                <option>متزوج</option><option>ارمله</option><option>مطلقة</option><option>مهجورة</option><option>اعزب</option><option>ايتام</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Area & Stats -->
                <div class="space-y-6">
                    <div class="flex items-center gap-3 text-emerald-600 font-black text-sm uppercase"><i data-lucide="map-pin"></i> السكن والإحصائيات</div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">عدد الذكور</label>
                            <input type="number" name="num_male" class="no-spinner w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none input-focus">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">عدد الإناث</label>
                            <input type="number" name="num_female" class="no-spinner w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none input-focus">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">المنطقة الأصلية</label>
                            <input type="text" name="loc_original" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none input-focus">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">منطقة النزوح</label>
                            <input type="text" name="loc_now" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none input-focus">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">المندوب المسؤول</label>
                            <input type="text" name="delegate" class="w-full p-4 bg-blue-50 border border-blue-100 rounded-2xl font-black text-blue-600 outline-none input-focus">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-400 mr-2">رقم جوال بديل</label>
                            <input type="number" name="phone_alt" maxlength="9" oninput="limitLen(this, 9)" class="no-spinner w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none input-focus">
                        </div>
                    </div>
                </div>

                <!-- Section 3: Family Members Dynamic -->
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3 text-indigo-600 font-black text-sm uppercase"><i data-lucide="users-2"></i> أفراد العائلة المضافين</div>
                        <button type="button" onclick="addFamilyRow()" class="px-6 py-2 bg-indigo-50 text-indigo-600 rounded-xl font-black text-[10px] hover:bg-indigo-100 transition">+ إضافة فرد</button>
                    </div>
                    <div id="family-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                </div>

                <!-- Section 4: Health Conditions Dynamic -->
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3 text-rose-600 font-black text-sm uppercase"><i data-lucide="heart-pulse"></i> الحالات المرضية والإعاقات</div>
                        <button type="button" onclick="addHealthRow()" class="px-6 py-2 bg-rose-50 text-rose-600 rounded-xl font-black text-[10px] hover:bg-rose-100 transition">+ إضافة حالة</button>
                    </div>
                    <div id="health-container" class="space-y-4"></div>
                </div>

                <!-- Section 5: Electronic Wallet -->
                <div class="space-y-6">
                    <div class="flex items-center gap-3 text-amber-600 font-black text-sm uppercase"><i data-lucide="wallet"></i> بيانات المحفظة الإلكترونية</div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <input type="text" name="wallet_name" placeholder="اسم مالك المحفظة" class="p-4 bg-amber-50 rounded-2xl font-bold outline-none input-focus">
                        <input type="number" name="wallet_id" placeholder="هوية المالك" oninput="limitLen(this, 9)" class="no-spinner p-4 bg-amber-50 rounded-2xl font-bold outline-none input-focus">
                        <input type="number" name="wallet_phone" placeholder="جوال المحفظة" oninput="limitLen(this, 9)" class="no-spinner p-4 bg-amber-50 rounded-2xl font-bold outline-none input-focus">
                    </div>
                </div>
            </form>

            <div class="p-10 border-t border-slate-100 bg-slate-50 flex gap-6">
                <button onclick="submitData()" id="save-btn" class="flex-1 py-6 btn-gradient text-white rounded-[2.5rem] font-black text-xl shadow-2xl">حفظ ومزامنة البيانات</button>
            </div>
        </div>
    </div>

    <!-- Details View Modal -->
    <div id="view-modal" class="fixed inset-0 z-[7000] bg-slate-900/80 backdrop-blur-xl hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-4xl max-h-[94vh] rounded-[4.5rem] shadow-2xl flex flex-col overflow-hidden fade-in relative">
            
            <button onclick="closeModals()" class="absolute top-8 left-8 p-4 bg-white/10 hover:bg-rose-500 text-slate-800 hover:text-white rounded-full transition z-10"><i data-lucide="x"></i></button>

            <!-- Card Header -->
            <div class="p-12 bg-slate-900 text-white flex justify-between items-end overflow-hidden relative">
                <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-4">
                        <span id="v-status-badge" class="px-4 py-1.5 bg-blue-600 text-[10px] rounded-full font-black tracking-widest uppercase">---</span>
                        <span id="v-delegate-badge" class="px-4 py-1.5 bg-white/10 text-[10px] rounded-full font-bold">---</span>
                    </div>
                    <h2 id="v-name" class="text-5xl font-black mb-2">---</h2>
                    <p id="v-id" class="text-slate-400 font-mono text-xl tracking-tighter">---</p>
                </div>
                <div class="relative z-10 text-center bg-white/5 p-6 rounded-[2.5rem] backdrop-blur-md border border-white/5">
                    <p class="text-[10px] font-bold text-slate-400 mb-1">إجمالي الأفراد</p>
                    <p id="v-total" class="text-5xl font-black text-blue-400">0</p>
                </div>
                <div class="absolute -right-20 -bottom-20 opacity-5">
                    <i data-lucide="database" class="w-80 h-80"></i>
                </div>
            </div>

            <div id="view-content" class="flex-1 overflow-y-auto p-12 space-y-12 custom-scroll bg-slate-50/50">
                <!-- Content will be injected by JS -->
            </div>

            <div class="p-8 bg-white border-t border-slate-100 flex gap-4">
                <button id="v-export-btn" class="flex-1 py-5 bg-blue-50 text-blue-600 rounded-3xl font-black flex items-center justify-center gap-2 hover:bg-blue-100 transition">
                    <i data-lucide="file-down"></i> تصدير تفاصيل السجل
                </button>
                <button onclick="closeModals()" class="px-12 py-5 bg-slate-900 text-white rounded-3xl font-black">إغلاق</button>
            </div>
        </div>
    </div>

    <!-- Custom Export Modal -->
    <div id="export-modal" class="fixed inset-0 z-[8000] bg-black/40 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-xl rounded-[3rem] p-10 space-y-6 fade-in shadow-2xl">
            <h3 class="text-2xl font-black">تصدير مخصص لملف Excel</h3>
            <p class="text-xs text-slate-400 font-bold">اختر الأعمدة التي ترغب في تضمينها في الملف:</p>
            <div id="export-options" class="grid grid-cols-2 gap-3 max-h-[40vh] overflow-y-auto p-2">
                <!-- Dynamic Checkboxes -->
            </div>
            <div class="flex gap-4 pt-6">
                <button onclick="executeCustomExport()" class="flex-1 py-5 btn-gradient text-white rounded-2xl font-black">بدء التصدير</button>
                <button onclick="closeModals()" class="px-8 py-5 bg-slate-100 rounded-2xl font-bold">إلغاء</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc, serverTimestamp, writeBatch } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCxI5hPvlddgn9aZUrewesDbg8YSD7bEnk",
            authDomain: "mosadata-18521.firebaseapp.com",
            projectId: "mosadata-18521",
            storageBucket: "mosadata-18521.firebasestorage.app",
            messagingSenderId: "517965913092",
            appId: "1:517965913092:web:39db81b21739cef58e6951",
            measurementId: "G-C00LHCKEG7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = "mosa_pro_v2_stable";

        let dataStore = [];
        let currentRole = 'guest';
        let editModeId = null;
        let lastDeleted = null;

        // --- Auth Logic ---
        window.showAdminPass = () => {
            document.getElementById('admin-gate-btn').classList.add('hidden');
            document.getElementById('admin-pass-input').classList.remove('hidden');
        };

        window.handleLogin = async (role) => {
            if(role === 'admin') {
                const pass = document.getElementById('login-pass').value;
                if(pass !== '123') return showToast("كلمة المرور غير صحيحة", "error");
                currentRole = 'admin';
            }
            try {
                await signInAnonymously(auth);
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                bootstrapApp();
            } catch(e) { showToast("فشل الاتصال السحابي", "error"); }
        };

        function bootstrapApp() {
            lucide.createIcons();
            document.getElementById('role-tag').innerText = currentRole === 'admin' ? 'مدير' : 'زائر';
            if(currentRole === 'admin') {
                document.getElementById('admin-shortcuts').classList.remove('hidden');
                document.getElementById('admin-export-tools').classList.remove('hidden');
            }

            const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'records'), orderBy('createdAt', 'desc'));
            onSnapshot(q, (snap) => {
                dataStore = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderData();
                updateStats();
            });
        }

        // --- Data Logic ---
        window.renderData = () => {
            const search = document.getElementById('main-search').value.toLowerCase();
            const statusF = document.getElementById('filter-status').value;
            const delegateF = document.getElementById('filter-delegate').value.toLowerCase();
            const areaF = document.getElementById('filter-area').value.toLowerCase();
            
            const tbody = document.getElementById('main-table-body');
            tbody.innerHTML = '';

            const filtered = dataStore.filter(r => {
                const searchStr = `${r.h_name} ${r.h_id} ${r.delegate} ${r.loc_now} ${r.h_phone}`.toLowerCase();
                return searchStr.includes(search) &&
                       (!statusF || r.status === statusF) &&
                       (!delegateF || r.delegate?.toLowerCase().includes(delegateF)) &&
                       (!areaF || r.loc_now?.toLowerCase().includes(areaF));
            });

            if(filtered.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
            } else {
                document.getElementById('empty-state').classList.add('hidden');
                filtered.forEach(r => {
                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-blue-50/50 transition-colors group";
                    tr.innerHTML = `
                        <td class="px-10 py-7">
                            <div class="text-slate-900 font-black">${r.h_name}</div>
                            <div class="text-[10px] text-slate-400 mt-1">${currentRole === 'admin' ? r.h_id : '*********'}</div>
                        </td>
                        <td class="px-10 py-7"><span class="px-3 py-1 bg-slate-100 text-slate-500 rounded-lg text-[10px] font-black">${r.delegate || '-'}</span></td>
                        <td class="px-10 py-7 text-xs">${r.status || '-'}</td>
                        <td class="px-10 py-7 text-[11px] text-slate-400 italic">${r.loc_now || '-'}</td>
                        <td class="px-10 py-7"><div class="w-10 h-10 bg-indigo-50 text-indigo-600 rounded-xl flex items-center justify-center font-black">${r.total_ppl || 0}</div></td>
                        <td class="px-10 py-7">
                            <div class="flex items-center justify-center gap-2 opacity-100 lg:opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="viewRecord('${r.id}')" class="p-3 bg-blue-600 text-white rounded-xl shadow-lg shadow-blue-100"><i data-lucide="eye" class="w-4 h-4"></i></button>
                                ${currentRole === 'admin' ? `
                                    <button onclick="editRecord('${r.id}')" class="p-3 bg-amber-500 text-white rounded-xl"><i data-lucide="edit-3" class="w-4 h-4"></i></button>
                                    <button onclick="deleteRecord('${r.id}')" class="p-3 bg-rose-500 text-white rounded-xl"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                ` : ''}
                            </div>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }
            lucide.createIcons();
        };

        function updateStats() {
            document.getElementById('stat-families').innerText = dataStore.length;
            const totalInd = dataStore.reduce((acc, r) => acc + (parseInt(r.total_ppl) || 0), 0);
            document.getElementById('stat-individuals').innerText = totalInd;
            
            const ids = dataStore.map(r => r.h_id).filter(id => id);
            const dups = ids.filter((id, index) => ids.indexOf(id) !== index);
            document.getElementById('stat-duplicates').innerText = dups.length;
        }

        // --- Form Management ---
        window.openForm = () => {
            editModeId = null;
            document.getElementById('main-form').reset();
            document.getElementById('family-container').innerHTML = '';
            document.getElementById('health-container').innerHTML = '';
            document.getElementById('modal-title').innerText = "إضافة سجل سحابي جديد";
            document.getElementById('form-modal').classList.remove('hidden');
            lucide.createIcons();
        };

        window.addFamilyRow = (data = {}) => {
            const id = Math.random().toString(36).substr(2, 9);
            const div = document.createElement('div');
            div.className = "p-6 bg-slate-50 rounded-[2.5rem] border border-slate-100 relative fade-in space-y-3";
            div.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <span class="text-[10px] font-black text-indigo-400">بيانات الفرد</span>
                    <button type="button" onclick="this.parentElement.parentElement.remove()" class="text-rose-500 p-2 hover:bg-rose-50 rounded-full transition"><i data-lucide="minus-circle" class="w-4 h-4"></i></button>
                </div>
                <input type="text" placeholder="الاسم الكامل" class="f-name w-full p-3 bg-white border border-slate-100 rounded-xl font-bold text-xs outline-none focus:ring-2 focus:ring-indigo-200" value="${data.name||''}">
                <div class="grid grid-cols-2 gap-3">
                    <select class="f-rel p-3 bg-white border border-slate-100 rounded-xl font-black text-[10px] outline-none">
                        <option ${data.rel==='ابن'?'selected':''}>ابن</option><option ${data.rel==='ابنه'?'selected':''}>ابنه</option>
                        <option ${data.rel==='زوجة'?'selected':''}>زوجة</option><option ${data.rel==='أب'?'selected':''}>أب</option>
                        <option ${data.rel==='أم'?'selected':''}>أم</option><option ${data.rel==='أخ'?'selected':''}>أخ</option>
                        <option ${data.rel==='أخت'?'selected':''}>أخت</option>
                    </select>
                    <input type="number" placeholder="رقم الهوية" oninput="limitLen(this, 9)" class="f-id w-full p-3 bg-white border border-slate-100 rounded-xl font-bold text-xs outline-none no-spinner" value="${data.id||''}">
                </div>
                <div class="flex items-center gap-3">
                    <label class="text-[9px] font-bold text-slate-400">تاريخ الميلاد:</label>
                    <input type="date" class="f-dob flex-1 p-2 bg-white border border-slate-100 rounded-xl text-[10px]" value="${data.dob||''}">
                </div>
            `;
            document.getElementById('family-container').appendChild(div);
            lucide.createIcons();
        };

        window.addHealthRow = (data = {}) => {
            const div = document.createElement('div');
            div.className = "p-5 bg-rose-50/50 rounded-3xl border border-rose-100 grid grid-cols-1 md:grid-cols-5 gap-3 relative fade-in items-center";
            div.innerHTML = `
                <select class="h-type p-3 bg-white rounded-xl text-[10px] font-black border border-rose-100 outline-none">
                    <option ${data.type==='مرض مزمن'?'selected':''}>مرض مزمن</option>
                    <option ${data.type==='اعاقة حركية'?'selected':''}>اعاقة حركية</option>
                    <option ${data.type==='اعاقة سمعية'?'selected':''}>اعاقة سمعية</option>
                    <option ${data.type==='اعاقة بصرية'?'selected':''}>اعاقة بصرية</option>
                    <option ${data.type==='اخرى'?'selected':''}>اخرى</option>
                </select>
                <input type="text" placeholder="الاسم" class="h-name p-3 bg-white rounded-xl text-[10px] border border-rose-100" value="${data.name||''}">
                <input type="number" placeholder="الهوية" oninput="limitLen(this, 9)" class="h-id p-3 bg-white rounded-xl text-[10px] border border-rose-100" value="${data.id||''}">
                <input type="number" placeholder="جوال" oninput="limitLen(this, 9)" class="h-phone p-3 bg-white rounded-xl text-[10px] border border-rose-100" value="${data.phone||''}">
                <input type="text" placeholder="نوع المرض بالتفصيل" class="h-desc p-3 bg-white rounded-xl text-[10px] border border-rose-100" value="${data.desc||''}">
                <button type="button" onclick="this.parentElement.remove()" class="absolute -top-2 -left-2 bg-white text-rose-500 p-1 rounded-full border border-rose-100 shadow-sm"><i data-lucide="minus" class="w-3 h-3"></i></button>
            `;
            document.getElementById('health-container').appendChild(div);
            lucide.createIcons();
        };

        window.submitData = async () => {
            const form = document.getElementById('main-form');
            const fd = new FormData(form);
            const basic = Object.fromEntries(fd);

            // Validation
            if(!basic.h_name || basic.h_id.length !== 9 || basic.h_phone.length !== 9) {
                return showToast("تأكد من إكمال البيانات (الهوية والجوال 9 أرقام)", "error");
            }

            const family = Array.from(document.querySelectorAll('#family-container > div')).map(row => {
                const dob = row.querySelector('.f-dob').value;
                return {
                    name: row.querySelector('.f-name').value,
                    rel: row.querySelector('.f-rel').value,
                    id: row.querySelector('.f-id').value,
                    dob: dob,
                    age: calculateAge(dob)
                };
            });

            const health = Array.from(document.querySelectorAll('#health-container > div')).map(row => ({
                type: row.querySelector('.h-type').value,
                name: row.querySelector('.h-name').value,
                id: row.querySelector('.h-id').value,
                phone: row.querySelector('.h-phone').value,
                desc: row.querySelector('.h-desc').value
            }));

            const payload = {
                ...basic,
                family,
                health,
                total_ppl: (1 + (basic.wife_name ? 1 : 0) + family.length),
                updatedAt: serverTimestamp()
            };

            try {
                if(editModeId) {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'records', editModeId), payload);
                    showToast("تم تحديث السجل بنجاح", "success");
                } else {
                    payload.createdAt = serverTimestamp();
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'records'), payload);
                    showToast("تمت الإضافة بنجاح", "success");
                }
                closeModals();
            } catch(e) { showToast("فشل الحفظ في السحابة", "error"); }
        };

        window.editRecord = (id) => {
            editModeId = id;
            const r = dataStore.find(x => x.id === id);
            const form = document.getElementById('main-form');
            
            document.getElementById('family-container').innerHTML = '';
            document.getElementById('health-container').innerHTML = '';

            for(const key in r) {
                if(form.elements[key]) form.elements[key].value = r[key];
            }

            if(r.family) r.family.forEach(f => addFamilyRow(f));
            if(r.health) r.health.forEach(h => addHealthRow(h));

            document.getElementById('modal-title').innerText = "تعديل بيانات السجل";
            document.getElementById('form-modal').classList.remove('hidden');
            lucide.createIcons();
        };

        window.deleteRecord = async (id) => {
            const record = dataStore.find(x => x.id === id);
            lastDeleted = { ...record };
            
            await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'records', id));
            
            const toast = document.getElementById('undo-toast');
            toast.classList.remove('hidden');
            
            const undoBtn = document.getElementById('undo-btn');
            let timeout = setTimeout(() => { toast.classList.add('hidden'); }, 5000);

            undoBtn.onclick = async () => {
                clearTimeout(timeout);
                delete lastDeleted.id;
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'records'), lastDeleted);
                toast.classList.add('hidden');
                showToast("تمت استعادة البيانات بنجاح", "success");
            };
        };

        // --- Details View ---
        window.viewRecord = (id) => {
            const r = dataStore.find(x => x.id === id);
            if(!r) return;

            document.getElementById('v-name').innerText = r.h_name;
            document.getElementById('v-id').innerText = currentRole === 'admin' ? r.h_id : 'رقم الهوية محجوب';
            document.getElementById('v-status-badge').innerText = r.status;
            document.getElementById('v-delegate-badge').innerText = `بإشراف: ${r.delegate || 'بدون مندوب'}`;
            document.getElementById('v-total').innerText = r.total_ppl || 0;

            const content = document.getElementById('view-content');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Basic Info -->
                    <div class="space-y-4">
                        <h4 class="text-xs font-black text-blue-600 uppercase tracking-widest flex items-center gap-2"><i data-lucide="info"></i> البيانات الأساسية</h4>
                        <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 space-y-3">
                            <div class="flex justify-between border-b border-slate-50 py-2"><span class="text-xs text-slate-400 font-bold">رقم الجوال:</span> <span class="text-sm font-black">${r.h_phone}</span></div>
                            <div class="flex justify-between border-b border-slate-50 py-2"><span class="text-xs text-slate-400 font-bold">جوال بديل:</span> <span class="text-sm font-black">${r.phone_alt || '-'}</span></div>
                            <div class="flex justify-between border-b border-slate-50 py-2"><span class="text-xs text-slate-400 font-bold">اسم الزوجة:</span> <span class="text-sm font-black">${r.wife_name || '-'}</span></div>
                            <div class="flex justify-between py-2"><span class="text-xs text-slate-400 font-bold">هوية الزوجة:</span> <span class="text-sm font-black">${currentRole === 'admin' ? (r.wife_id || '-') : 'محجوب'}</span></div>
                        </div>
                    </div>
                    <!-- Geography -->
                    <div class="space-y-4">
                        <h4 class="text-xs font-black text-emerald-600 uppercase tracking-widest flex items-center gap-2"><i data-lucide="map"></i> السكن والنزوح</h4>
                        <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 space-y-3">
                            <div class="flex justify-between border-b border-slate-50 py-2"><span class="text-xs text-slate-400 font-bold">المنطقة الأصلية:</span> <span class="text-sm font-black">${r.loc_original || '-'}</span></div>
                            <div class="flex justify-between border-b border-slate-50 py-2"><span class="text-xs text-slate-400 font-bold">منطقة النزوح الحالية:</span> <span class="text-sm font-black text-emerald-600">${r.loc_now || '-'}</span></div>
                            <div class="flex justify-between py-2"><span class="text-xs text-slate-400 font-bold">توزيع الأفراد:</span> <span class="text-sm font-black">ذكور: ${r.num_male || 0} | إناث: ${r.num_female || 0}</span></div>
                        </div>
                    </div>
                </div>

                <!-- Family List -->
                ${r.family?.length > 0 ? `
                <div class="space-y-4">
                    <h4 class="text-xs font-black text-indigo-600 uppercase tracking-widest flex items-center gap-2"><i data-lucide="users"></i> أفراد العائلة (${r.family.length})</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${r.family.map(f => `
                            <div class="p-5 bg-white rounded-3xl border border-slate-100">
                                <p class="text-xs font-black mb-1">${f.name}</p>
                                <p class="text-[9px] text-slate-400 font-bold">${f.rel} | ${currentRole === 'admin' ? f.id : '*********'}</p>
                                <p class="text-[9px] text-indigo-500 font-black mt-2 italic underline underline-offset-4">${f.age}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>` : ''}

                <!-- Health Section -->
                ${r.health?.length > 0 ? `
                <div class="space-y-4">
                    <h4 class="text-xs font-black text-rose-600 uppercase tracking-widest flex items-center gap-2"><i data-lucide="activity"></i> الحالات الطبية</h4>
                    <div class="space-y-3">
                        ${r.health.map(h => `
                            <div class="flex items-center gap-4 p-5 bg-rose-50/50 rounded-3xl border border-rose-100">
                                <div class="w-10 h-10 bg-rose-100 text-rose-600 rounded-xl flex items-center justify-center"><i data-lucide="shield-alert"></i></div>
                                <div>
                                    <p class="text-xs font-black">${h.name} - <span class="text-rose-600">${h.type}</span></p>
                                    <p class="text-[10px] text-slate-500">${h.desc} | هوية: ${currentRole === 'admin' ? h.id : '****'} | جوال: ${h.phone}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>` : ''}

                <!-- Wallet Section -->
                <div class="space-y-4">
                    <h4 class="text-xs font-black text-amber-600 uppercase tracking-widest flex items-center gap-2"><i data-lucide="credit-card"></i> المحفظة الإلكترونية</h4>
                    <div class="bg-amber-50/50 p-6 rounded-[2.5rem] border border-amber-100 grid grid-cols-3 gap-4">
                        <div><p class="text-[9px] font-bold text-slate-400">المالك</p><p class="text-xs font-black">${r.wallet_name || '-'}</p></div>
                        <div><p class="text-[9px] font-bold text-slate-400">الهوية</p><p class="text-xs font-black">${currentRole === 'admin' ? (r.wallet_id || '-') : 'محجوب'}</p></div>
                        <div><p class="text-[9px] font-bold text-slate-400">رقم الجوال</p><p class="text-xs font-black text-amber-600">${r.wallet_phone || '-'}</p></div>
                    </div>
                </div>
            `;

            document.getElementById('v-export-btn').onclick = () => exportRecordToExcel(r);
            document.getElementById('view-modal').classList.remove('hidden');
            lucide.createIcons();
        };

        // --- Excel Tools ---
        window.downloadTemplate = () => {
            const schema = ["اسم رب الاسرة", "هوية رب الاسرة", "رقم الجوال", "الزوجة", "هوية الزوجة", "الحالة الاجتماعية", "عدد الذكور", "عدد الاناث", "المنطقة الاصلية", "منطقة النزوح", "المندوب", "جوال بديل", "اسم مالك المحفظة", "هوية المالك", "جوال المحفظة"];
            const ws = XLSX.utils.aoa_to_sheet([schema]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Template");
            XLSX.writeFile(wb, "MosaData_Template.xlsx");
        };

        window.handleExcelImport = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = async (event) => {
                const data = new Uint8Array(event.target.result);
                const wb = XLSX.read(data, { type: 'array' });
                const json = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
                
                const batch = writeBatch(db);
                json.forEach(row => {
                    const docRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'records'));
                    batch.set(docRef, {
                        h_name: row["اسم رب الاسرة"] || "",
                        h_id: String(row["هوية رب الاسرة"] || "").slice(0, 9),
                        h_phone: String(row["رقم الجوال"] || "").slice(0, 9),
                        wife_name: row["الزوجة"] || "",
                        wife_id: String(row["هوية الزوجة"] || "").slice(0, 9),
                        status: row["الحالة الاجتماعية"] || "متزوج",
                        num_male: row["عدد الذكور"] || 0,
                        num_female: row["عدد الاناث"] || 0,
                        loc_original: row["المنطقة الاصلية"] || "",
                        loc_now: row["منطقة النزوح"] || "",
                        delegate: row["المندوب"] || "",
                        phone_alt: String(row["جوال بديل"] || "").slice(0, 9),
                        wallet_name: row["اسم مالك المحفظة"] || "",
                        wallet_id: String(row["هوية المالك"] || "").slice(0, 9),
                        wallet_phone: String(row["جوال المحفظة"] || "").slice(0, 9),
                        total_ppl: (1 + (row["الزوجة"]?1:0) + (parseInt(row["عدد الذكور"])||0) + (parseInt(row["عدد الاناث"])||0)),
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });
                });
                await batch.commit();
                showToast(`تم استيراد ${json.length} سجل بنجاح`, "success");
            };
            reader.readAsArrayBuffer(file);
        };

        window.openExportModal = () => {
            const opts = document.getElementById('export-options');
            const fields = [
                {k: 'h_name', n: 'اسم رب الأسرة'}, {k: 'h_id', n: 'الهوية'}, {k: 'h_phone', n: 'الجوال'},
                {k: 'wife_name', n: 'الزوجة'}, {k: 'status', n: 'الحالة'}, {k: 'delegate', n: 'المندوب'},
                {k: 'loc_now', n: 'النزوح'}, {k: 'total_ppl', n: 'إجمالي الأفراد'}, {k: 'wallet_phone', n: 'جوال المحفظة'}
            ];
            opts.innerHTML = fields.map(f => `
                <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition">
                    <input type="checkbox" value="${f.k}" checked class="w-4 h-4 rounded">
                    <span class="text-[10px] font-black">${f.n}</span>
                </label>
            `).join('');
            document.getElementById('export-modal').classList.remove('hidden');
        };

        window.executeCustomExport = () => {
            const selected = Array.from(document.querySelectorAll('#export-options input:checked')).map(i => i.value);
            const reportData = dataStore.map(r => {
                let obj = {};
                selected.forEach(s => obj[s] = r[s] || "");
                return obj;
            });
            const ws = XLSX.utils.json_to_sheet(reportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Records");
            XLSX.writeFile(wb, "Custom_Export.xlsx");
            closeModals();
        };

        function exportRecordToExcel(r) {
            const data = [{
                "الاسم": r.h_name, "الهوية": r.h_id, "الجوال": r.h_phone, "المندوب": r.delegate, "الحالة": r.status,
                "الزوجة": r.wife_name, "هوية الزوجة": r.wife_id, "إجمالي الأفراد": r.total_ppl, "منطقة النزوح": r.loc_now,
                "المحفظة": r.wallet_name, "جوال المحفظة": r.wallet_phone
            }];
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Detail");
            XLSX.writeFile(wb, `${r.h_name}_details.xlsx`);
        }

        // --- Utilities ---
        window.limitLen = (el, max) => { if(el.value.length > max) el.value = el.value.slice(0, max); };
        window.closeModals = () => {
            document.querySelectorAll('[id$="-modal"]').forEach(m => m.classList.add('hidden'));
        };
        window.showToast = (msg, type) => {
            const container = document.getElementById('toast-container');
            const div = document.createElement('div');
            div.className = `fade-in px-8 py-4 rounded-2xl shadow-xl flex items-center gap-4 text-white border border-white/10 ${type==='error'?'bg-rose-600':'bg-slate-900'}`;
            div.innerHTML = `<span class="text-xs font-black">${msg}</span>`;
            container.appendChild(div);
            setTimeout(() => div.remove(), 4000);
        };
        window.toggleAdvancedFilter = () => { document.getElementById('advanced-filters').classList.toggle('hidden'); };
        window.calculateAge = (dob) => {
            if(!dob) return "-";
            const birth = new Date(dob);
            const now = new Date();
            let years = now.getFullYear() - birth.getFullYear();
            let months = now.getMonth() - birth.getMonth();
            if (months < 0) { years--; months += 12; }
            return `${years} سنة و ${months} شهر`;
        };
        window.clearFilters = () => {
            ['filter-status', 'filter-delegate', 'filter-area'].forEach(id => document.getElementById(id).value = '');
            renderData();
        };
    </script>
</body>
</html>
